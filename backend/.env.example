# .env.example
# Mira Backend Environment Configuration - OpenAI GPT-5.1 + Embeddings
# Copy this file to .env and fill in your actual values

# ============================================================================
# OPENAI (PRIMARY LLM + EMBEDDINGS)
# ============================================================================
# OpenAI GPT-5.1 family with 4-tier model routing:
# - Fast: GPT-5.1 Mini (file ops, search)
# - Voice: GPT-5.1 (user chat, explanations)
# - Code: GPT-5.1-Codex-Max (code generation, refactoring)
# - Agentic: GPT-5.1-Codex-Max (long-running tasks)
#
# Embeddings: text-embedding-3-large (3072 dimensions)

# OpenAI API key (required)
OPENAI_API_KEY=your-openai-api-key-here

# ============================================================================
# MODEL ROUTER CONFIGURATION
# ============================================================================
MODEL_ROUTER_ENABLED=true
MODEL_FAST=gpt-5.1-codex-mini
MODEL_VOICE=gpt-5.1
MODEL_CODE=gpt-5.1-codex-max
MODEL_AGENTIC=gpt-5.1-codex-max
ROUTE_CODE_TOKEN_THRESHOLD=50000
ROUTE_CODE_FILE_COUNT=3

# ============================================================================
# BUDGET MANAGEMENT
# ============================================================================
BUDGET_DAILY_LIMIT_USD=5.0
BUDGET_MONTHLY_LIMIT_USD=150.0

# ============================================================================
# CONTEXT BUDGET
# ============================================================================
# Maximum context tokens (0 = no limit)
MAX_CONTEXT_TOKENS=0
# Enable proactive warnings when approaching limits
ENABLE_CONTEXT_WARNINGS=true

# ============================================================================
# LLM RESPONSE CACHE
# ============================================================================
CACHE_ENABLED=true
CACHE_TTL_SECONDS=86400

# ============================================================================
# STRUCTURED OUTPUT
# ============================================================================
MAX_OUTPUT_TOKENS=128000
MAX_JSON_OUTPUT_TOKENS=128000
ENABLE_JSON_VALIDATION=true
MAX_JSON_REPAIR_ATTEMPTS=3

# ============================================================================
# DATABASE & STORAGE
# ============================================================================
DATABASE_URL=sqlite:./data/mira.db
MIRA_SQLITE_MAX_CONNECTIONS=100

# ============================================================================
# QDRANT VECTOR DATABASE
# ============================================================================
QDRANT_URL=http://localhost:6334
QDRANT_COLLECTION=mira-memories
QDRANT_EMBEDDING_DIM=3072

# ============================================================================
# SESSION & USER
# ============================================================================
MIRA_SESSION_ID=default-session
MIRA_DEFAULT_PERSONA=Default

# ============================================================================
# MEMORY & CONTEXT
# ============================================================================
MIRA_CONTEXT_RECENT_MESSAGES=50
MIRA_CONTEXT_SEMANTIC_MATCHES=25

# ============================================================================
# MEMORY SERVICE
# ============================================================================
MEM_ALWAYS_EMBED_USER=true
MEM_ALWAYS_EMBED_ASSISTANT=true
MEM_EMBED_MIN_CHARS=6
MEM_DEDUP_SIM_THRESHOLD=0.97
MEM_SALIENCE_MIN_FOR_EMBED=0.5
MIN_SALIENCE_FOR_QDRANT=0.5

# ============================================================================
# EMBEDDING CONFIGURATION
# ============================================================================
MIRA_EMBED_MODEL=text-embedding-3-large
MIRA_EMBED_DIMENSIONS=3072
MIRA_EMBED_HEADS=semantic,code,summary,documents,relationship
MIRA_EMBED_CODE_FROM_CHAT=false

# ============================================================================
# MEMORY DECAY
# ============================================================================
MIRA_DECAY_RECENT_HALF_LIFE_DAYS=30.0
MIRA_DECAY_GENTLE_FACTOR=0.1
MIRA_DECAY_STRONGER_FACTOR=0.3
MIRA_DECAY_FLOOR=0.2
MIRA_DECAY_HIGH_SALIENCE_THRESHOLD=0.7

# ============================================================================
# RECALL & CONTEXT
# ============================================================================
MIRA_RECALL_RECENT=10
MIRA_RECALL_SEMANTIC=20
MIRA_RECALL_K_PER_HEAD=10

# ============================================================================
# SUMMARIZATION
# ============================================================================
MIRA_ENABLE_SUMMARIZATION=true
MIRA_SUMMARY_TOKEN_LIMIT=64000
MIRA_SUMMARY_OUTPUT_TOKENS=8192
MIRA_SUMMARIZE_AFTER_MESSAGES=20
MIRA_SUMMARY_ROLLING_10=true
MIRA_SUMMARY_ROLLING_100=true
MIRA_USE_ROLLING_SUMMARIES_IN_CONTEXT=true
MIRA_ROLLING_SUMMARY_MAX_AGE_HOURS=168
MIRA_ROLLING_SUMMARY_MIN_GAP=3

# ============================================================================
# VECTOR SEARCH
# ============================================================================
MIRA_MAX_VECTOR_RESULTS=10
MIRA_ENABLE_VECTOR_SEARCH=true

# ============================================================================
# TOOLS
# ============================================================================
MIRA_ENABLE_CHAT_TOOLS=true
MIRA_ENABLE_WEB_SEARCH=true
MIRA_WEB_SEARCH_MAX_RESULTS=20
MIRA_TOOL_TIMEOUT_SECONDS=60
TOOL_MAX_ITERATIONS=25

# ============================================================================
# SERVER
# ============================================================================
MIRA_HOST=0.0.0.0
MIRA_PORT=3001
MIRA_MAX_CONCURRENT_EMBEDDINGS=25

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=50
RATE_LIMIT_TIERED_ENABLED=true
RATE_LIMIT_LARGE_CONTEXT_RPM=25

# ============================================================================
# TIMEOUTS
# ============================================================================
OPENAI_TIMEOUT=600
QDRANT_TIMEOUT=60
DATABASE_TIMEOUT=30

# ============================================================================
# LOGGING
# ============================================================================
MIRA_LOG_LEVEL=debug
RUST_LOG=info

# ============================================================================
# RESPONSE CONFIGURATION
# ============================================================================
MIRA_MAX_RESPONSE_TOKENS=128000

# ============================================================================
# RECENT CACHE
# ============================================================================
MIRA_ENABLE_RECENT_CACHE=true
MIRA_RECENT_CACHE_CAPACITY=100
MIRA_RECENT_CACHE_TTL=300
MIRA_RECENT_CACHE_MAX_PER_SESSION=50
MIRA_RECENT_CACHE_WARMUP=true

# ============================================================================
# BACKGROUND TASKS
# ============================================================================
TASK_ANALYSIS_ENABLED=true
TASK_ANALYSIS_INTERVAL=10
TASK_DECAY_ENABLED=true
TASK_DECAY_INTERVAL=14400
TASK_CLEANUP_ENABLED=true
TASK_CLEANUP_INTERVAL=3600
TASK_SESSION_MAX_AGE_HOURS=168
TASK_SUMMARY_ENABLED=true
TASK_SUMMARY_INTERVAL=300
TASK_CODE_SYNC_ENABLED=true
TASK_CODE_SYNC_INTERVAL=300
ACTIVE_SESSION_LIMIT=100
