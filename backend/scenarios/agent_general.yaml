name: "General Agent - Implementation Tasks"
description: "Test the General agent's ability to implement features with full tool access"
tags: ["agents", "general", "implementation", "disabled"]
timeout_seconds: 600

setup:
  create_dirs:
    - "src"
  create_files:
    - path: "src/lib.rs"
      content: |
        // Library root
        pub mod calculator;
    - path: "src/calculator.rs"
      content: |
        /// Simple calculator module

        /// Adds two numbers together
        pub fn add(a: i32, b: i32) -> i32 {
            a + b
        }

        /// Subtracts b from a
        pub fn subtract(a: i32, b: i32) -> i32 {
            a - b
        }

        #[cfg(test)]
        mod tests {
            use super::*;

            #[test]
            fn test_add() {
                assert_eq!(add(2, 3), 5);
                assert_eq!(add(-1, 1), 0);
            }

            #[test]
            fn test_subtract() {
                assert_eq!(subtract(5, 3), 2);
                assert_eq!(subtract(0, 5), -5);
            }
        }

steps:
  - name: "General agent adds multiply function"
    prompt: |
      IMMEDIATELY call the spawn_agent tool right now with these exact parameters:
      - agent_type: "general"
      - task: "Add a multiply function to src/calculator.rs with a test. Takes two i32 args, returns i32."

      Do NOT delegate this to a background session. Call spawn_agent directly in your response.
    timeout_seconds: 180
    assertions:
      - type: completed_successfully
      - type: tool_executed
        tool_name: spawn_agent
        success: true
      - type: file_contains
        path: "src/calculator.rs"
        text: "multiply"
      - type: file_contains
        path: "src/calculator.rs"
        text: "test_multiply"

  - name: "General agent adds divide function with error handling"
    prompt: |
      IMMEDIATELY call the spawn_agent tool right now with these exact parameters:
      - agent_type: "general"
      - task: "Add a divide function to src/calculator.rs returning Option<i32>. Return None if b is zero."

      Do NOT delegate this to a background session. Call spawn_agent directly in your response.
    timeout_seconds: 180
    assertions:
      - type: completed_successfully
      - type: tool_executed
        tool_name: spawn_agent
        success: true
      - type: file_contains
        path: "src/calculator.rs"
        text: "divide"
      - type: file_contains
        path: "src/calculator.rs"
        text: "Option"

  - name: "General agent creates new module"
    prompt: |
      IMMEDIATELY call the spawn_agent tool right now with these exact parameters:
      - agent_type: "general"
      - task: "Create src/constants.rs with PI, E, and MAX_VALUE constants. Update src/lib.rs to export it."

      Do NOT delegate this to a background session. Call spawn_agent directly in your response.
    timeout_seconds: 180
    assertions:
      - type: completed_successfully
      - type: tool_executed
        tool_name: spawn_agent
        success: true
      - type: file_exists
        path: "src/constants.rs"
      - type: file_contains
        path: "src/constants.rs"
        text: "PI"
      - type: file_contains
        path: "src/lib.rs"
        text: "constants"

cleanup:
  remove_project: true
