name: "MCP Infrastructure - Routing and Error Handling"
description: "Test MCP tool routing infrastructure paths (no external server required)"
tags: ["mcp", "infrastructure", "routing", "e2e"]
timeout_seconds: 180

setup:
  create_files:
    - path: "README.md"
      content: |
        # MCP Infrastructure Test Project

        This project tests the MCP routing infrastructure.

        ## Purpose
        Verify that:
        - MCP tools are only available when servers are configured
        - The system gracefully handles missing MCP servers
        - Native tools work correctly as fallback

steps:
  - name: "Verify MCP tools availability status"
    prompt: |
      What tools do you have that start with "mcp__" prefix? Just tell me if you have any MCP tools or not.

      Do NOT delegate this to a background session. Answer directly.
    timeout_seconds: 60
    assertions:
      - type: completed_successfully
      # Without MCP servers configured, there should be no mcp__ tools
      - type: response_not_contains
        text: "mcp__filesystem"

  - name: "Test graceful handling without MCP"
    prompt: |
      Read the README.md file and show me its full contents. What does it say?
    timeout_seconds: 60
    assertions:
      - type: completed_successfully
      - type: no_errors
      # Should successfully read using native tool
      - type: tool_executed
        tool_name: read_project_file
        success: true
      - type: response_contains
        text: "MCP Infrastructure Test"

  - name: "Native tools work as expected"
    prompt: |
      Create a new file called test_output.txt with the content "Native tools working correctly"
    timeout_seconds: 90
    assertions:
      - type: completed_successfully
      - type: tool_executed
        tool_name: write_project_file
        success: true
      - type: file_exists
        path: "test_output.txt"
      - type: file_contains
        path: "test_output.txt"
        text: "Native tools working correctly"

cleanup:
  remove_project: true
