# scenarios/code_search.yaml
# Test code search and grep functionality

name: "Code Search"
description: "Verify search_codebase and grep tools work correctly"
tags: ["tools", "search"]
timeout_seconds: 180

setup:
  create_files:
    - path: "src/main.rs"
      content: |
        fn main() {
            println!("Hello, world!");
            let config = load_config();
            run_app(config);
        }

        fn load_config() -> Config {
            Config::default()
        }

        fn run_app(config: Config) {
            // TODO: implement app logic
        }
    - path: "src/lib.rs"
      content: |
        pub struct Config {
            pub debug: bool,
            pub port: u16,
        }

        impl Default for Config {
            fn default() -> Self {
                Config { debug: false, port: 8080 }
            }
        }
    - path: "src/utils.rs"
      content: |
        pub fn format_error(msg: &str) -> String {
            format!("Error: {}", msg)
        }

        pub fn log_debug(msg: &str) {
            println!("[DEBUG] {}", msg);
        }

steps:
  - name: "Search for function"
    prompt: "Search the codebase for the function 'load_config'"
    timeout_seconds: 60
    assertions:
      - type: completed_successfully
      - type: response_contains
        text: "load_config"

  - name: "Search for struct"
    prompt: "Find where the Config struct is defined"
    timeout_seconds: 60
    assertions:
      - type: completed_successfully
      - type: response_contains
        text: "Config"

  - name: "List project files"
    prompt: "List all the files in this project directory"
    timeout_seconds: 60
    assertions:
      - type: completed_successfully
      - type: response_contains
        text: "main.rs"

cleanup:
  remove_project: true
