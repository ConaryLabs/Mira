# consult_experts

Consult one or more expert roles in parallel for second opinions on code, architecture, security, and planning decisions. Each expert analyzes the provided context and returns findings and recommendations.

## Usage

```json
{
  "name": "consult_experts",
  "arguments": {
    "roles": ["architect", "security"],
    "context": "We're adding a new REST API endpoint that accepts user-uploaded files...",
    "question": "What security concerns should we address?"
  }
}
```

## Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| roles | Array[String] | Yes | Expert roles to consult in parallel |
| context | String | Yes | Code, design, or situation to analyze |
| question | String | No | Specific question for all experts |

### Available Roles

| Role | Description |
|------|-------------|
| `architect` | System design, patterns, tradeoffs |
| `plan_reviewer` | Validate implementation plans before coding |
| `scope_analyst` | Identify missing requirements and edge cases |
| `code_reviewer` | Find bugs and code quality issues |
| `security` | Identify vulnerabilities and suggest hardening |

## Returns

Combined output from all consulted experts, separated by `---` dividers, with a summary line:

```
## Architect

[Analysis and recommendations...]

---

## Security Analyst

[Analysis and recommendations...]

---

*Consulted 2 experts in parallel*
```

If any experts fail, the summary indicates: `*Consulted 3 experts: 2 succeeded, 1 failed*`

Expert responses may include findings that are automatically stored and can be managed with the `finding` tool.

## Concurrency

- Experts run in parallel with a maximum concurrency of 3
- Overall timeout: 15 minutes
- Individual expert failures don't block other experts

## Examples

**Example 1: Architecture review**
```json
{
  "name": "consult_experts",
  "arguments": {
    "roles": ["architect"],
    "context": "Current auth uses session cookies. Considering migration to JWT for the API.",
    "question": "What are the tradeoffs of this migration?"
  }
}
```

**Example 2: Code review with security**
```json
{
  "name": "consult_experts",
  "arguments": {
    "roles": ["code_reviewer", "security"],
    "context": "fn handle_query(input: &str) -> Result<Vec<Row>> {\n    let sql = format!(\"SELECT * FROM users WHERE name = '{}'\", input);\n    db.query(&sql)\n}"
  }
}
```

**Example 3: Plan validation**
```json
{
  "name": "consult_experts",
  "arguments": {
    "roles": ["plan_reviewer", "scope_analyst"],
    "context": "Plan: 1) Add caching layer with Redis 2) Migrate hot queries 3) Add cache invalidation on writes"
  }
}
```

## Errors

- **No LLM provider available**: Requires `DEEPSEEK_API_KEY` or `GEMINI_API_KEY` configured.
- **Invalid role**: The role must be one of the valid role keys.
- **Timeout**: Consultations exceeding 15 minutes are cancelled.

## See Also

- **configure_expert**: Customize expert providers, models, and system prompts
- **finding**: Manage findings generated by expert consultations
- **usage**: Track LLM usage and costs from consultations
