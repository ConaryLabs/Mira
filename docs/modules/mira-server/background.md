<!-- docs/modules/mira-server/background.md -->
# background

Background workers for idle-time processing. Split into two lanes based on latency requirements.

## Lanes

### Fast Lane
Handles embedding generation and incremental indexing. Woken immediately via `FastLaneNotify.wake()` when new work arrives (e.g., after file watcher updates queue new embeddings).

### Slow Lane
Handles heuristic analysis tasks: session summaries, pondering/insights, code health analysis, and proactive suggestions. Runs on a longer polling interval.

## Sub-modules

| Module | Lane | Purpose |
|--------|------|---------|
| `fast_lane` | fast | Embedding queue processing, incremental indexing |
| `slow_lane` | slow | LLM task orchestration |
| `embeddings` | fast | Pending embedding generation |
| `session_summaries` | slow | Session summary generation |
| `pondering` | slow | Insight extraction and pattern detection |
| `code_health` | slow | Code health analysis |
| `documentation` | slow | Documentation gap scanning |
| `diff_analysis` | slow | Semantic diff analysis |
| `briefings` | slow | What's-new briefing generation |
| `change_patterns` | slow | Change pattern mining from git history |
| `entity_extraction` | slow | Entity extraction from memories and code |
| `outcome_scanner` | slow | Outcome tracking for predictions |
| `summaries` | slow | Module summary generation |
| `memory_embeddings` | slow | Memory embedding generation |
| `knowledge_distillation` | on-demand | Cross-session insight extraction |
| `team_monitor` | slow | Team activity monitoring |
| `watcher` | independent | Filesystem watching for incremental updates |

## Background Task Behavior

All background tasks run using heuristic analysis. No LLM provider is required or used.

| Task | Method |
|------|--------|
| Module summaries | Heuristic: file count, languages, top symbols |
| Diff analysis | Heuristic: regex-based function/security detection |
| Pondering/insights | Heuristic: tool usage stats, friction detection, focus areas |
| Session summaries | Skipped |
| Code health | Pattern-based detection (TODOs, unwraps, cargo warnings) |

Heuristic results are tagged with `[heuristic]` prefix.

## Key Types

- `FastLaneNotify` - Notification handle to wake the fast lane worker
- `FastLaneWorker` / `SlowLaneWorker` - Worker implementations with supervisor pattern (exponential backoff, max restart logic)
- `HEURISTIC_PREFIX` / `TEMPLATE_PREFIX` - Constants for tagging fallback results
- `is_fallback_content()` - Check if content was generated by heuristic fallback

## Entry Points

- `spawn()` - Spawn both workers with a single pool
- `spawn_with_pools()` - Spawn with separate main/code pools
